---
title: "Do Meat Toppings Effect Pizza Sales?"
subtitle: "Datasci 203: Lab Report 2"
author: "Blake Bleier, Reese Carlton, Nicholas Lin, & Peter Valverde" 
output: 
  pdf_document:
    latex_engine: xelatex
    toc: true # table of content true
    toc_depth: 1  # upto three depths of headings (specified by #, ## and ###)
    number_sections: true
---
\newpage
\setcounter{page}{1}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, echo = FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readxl)
library(gridExtra)
library(lubridate)
library(mltools)
library(data.table)
```

# Introduction (1)

Restaurants belong in a competitive industry where success is determined by a delicate balance of food quality, service, and financial judgement. To understand financial decisions restaurants need to carefully manage costs, employ strategic pricing strategies, and maximize sales. With technology continuing to grow and impact our everyday lives, it can be beneficial for non-data driven industries, such as restaurants, to involve data into their decision making. One possibility to do so is to leverage order data to enhance sale strategies and overall performance. By analyzing order histories, restaurants might be able to unravel valuable insights into customer preferences, ordering patterns, and popular menu items. Understanding customer behaviors through this data can allow restaurants to tailor their offerings, optimize menus, and strategically price items. For pizza restaurants, analyzing the correlation between pizza ingredients and sales can reveal valuable insights into customer preferences and optimize their offerings optimally. Understanding the impact of pricing alongside ingredient combinations can guide decisions on pricing strategies or seasonal promotions, ultimately boosting sales and customer satisfaction.

The goal of this study is to estimate what types of ingredients can significantly influence pizza sales, by using artificial data for a pizza restaurant. By running a set of regression models, we attempt to estimate the values that pizza ingredients have on pizza sales.

# Data and Methodology (2-3)

The data in this study is a data set made for Plato's Pizza, a fictitious pizza restaurant based in New Jersey. It was made publicly available by a group called Maven Analytics. It includes about a year's worth of 48620 pizza orders, where each row shows the details about the order such as date and time, number of pizzas, type of pizzas, size, quantity, price, and ingredients. 

To organize and operationalize sales for the data, individual pizza orders were aggregated into monthly sales per type of pizza. Then, pizza ingredients were split into their respective categories of meat, sauce, cheese, and vegetables. For each pizza, the categories of ingredients were then counted. After organizing the data, it was randomly split into 75% for exploration analysis and 25% of modeling building. The final exploration and model building data set had 110 and 275 data points respectively.

# An Explanation of Key Modeling Decisions (4)

## Observations Removed:

No observations were intentionally removed from the dataset. The analysis was conducted on the complete dataset available for Plato's Pizza, and no observations were excluded due to missing values or other criteria.


## Variable Transformations:

The dataset is aggregated at the 'pizza_name' and 'month' level without additional changes. These alterations to the data involves creating a summary dataset at a higher level of granularity, providing a monthly overview of key metrics for each pizza type.

## Intentional Covariate Exclusions:

No covariates were intentionally excluded from the provided information. The transformed dataset includes relevant variables for the analysis, such as counts of ingredients, meat, alternative cheese (not mozzarella), alternarive sauce (not red sauce), veggie, and binary indicators. The inclusion of these variables aligns with the research question and allows for a comprehensive analysis of pizza sales based on ingredients in the pizza.

# A Table or Visualization (5)

```{r, echo = FALSE, message = FALSE, show_col_types = FALSE}
train <- read_csv("../data/processed/train_data.csv") 
basic_boxplot <- ggplot(train, aes(x = reorder(is_vegetarian, desc(is_vegetarian)), y = total_sales)) +
  geom_boxplot(fill = "skyblue", alpha = 0.7) +
  labs(title = "Basic Model: Sales for Vegetarian vs Non-Vegetarian Pizzas",
       x = "Vegetarian Pizza",
       y = "Total Sales") +
  theme_minimal() + theme(plot.margin=unit(c(0,.25,0,0), "cm")) +
  theme(plot.title = element_text(hjust = .5)) +
  theme(plot.title = element_text(vjust = -1)) +
  theme(axis.title.x = element_text(vjust = 5.5))
```

The box plot analysis indicates that, on average, non-vegetarian pizzas tend to have higher Total Sales compared to vegetarian pizzas. While medians provide insights into the central tendency, the spread of the box plot and the presence of outliers suggest that the distribution of Total Sales is broader for non-vegetarian pizzas. This finding could guide further investigations into the factors influencing Total Sales for each category, helping restaurant owners make informed decisions about their pizza offerings.


```{r, echo = FALSE, message = FALSE}
scatterplot <- ggplot(train, aes(x = meat_count, y = total_sales, color = meat_count)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "blue") +
  labs(title = "Advanced Model: Sales by Number of Meats on Pizza",
       x = "Meat Count",
       y = "Total Sales",
       color = "Number of Meats") +
  theme_minimal() + theme(legend.position = "none")
```
In the scatterplot with the trendline, we observe a positive linear relationship between Meat Count and Total Sales. The blue regression line indicates a positive slope, suggesting that as the Meat Count increases, the Total Sales tend to increase. However, it's essential to note that the scatterplot points show some variability, and there might be other factors influencing the relationship especially around Meat Count of 2

The boxplot provides a summary of the distribution of Total Sales across different Meat Counts. The boxplot indicates that the median Total Sales increase with the Meat Count up to 2, where it reaches a peak. Beyond 2 meats, the median Total Sales start to decline. This pattern is consistent with the observation in the scatterplot.

```{r, echo = FALSE, message = FALSE}
boxplot <- ggplot(train, aes(x = factor(meat_count), y = total_sales)) +
  geom_boxplot(fill = "skyblue", alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, linetype = "solid", color = "deepskyblue", aes(group=1)) +
  labs(title = "Advanced Model: Sales by Number of Meats on Pizza", x = "Number of Meats",
       y = "Total Sales") +
  theme_minimal() + theme(plot.margin=unit(c(.25,0,0,0), "cm")) +
  theme(plot.title = element_text(hjust = .5)) +
  theme(plot.title = element_text(vjust = -1))

grid.arrange(basic_boxplot, boxplot, nrow=2,heights=c(2,2))
```


The scatterplot and boxplot together indicate that while there is a positive linear trend between Meat Count and Total Sales, the relationship is not strictly monotonic. The plateau and subsequent decline in median Total Sales beyond 2 meats suggest that there may be an optimal range of Meat Count for maximizing Total Sales. Further analysis and potential model refinement may be needed to capture the nuanced relationship between the predictors and Total Sales.

## Model 3: Sales = Intercept + Indicators_for_each_type_of_meat + Number_of_topings + Month + Alternative_Sauce_Indicator + Alternative_Cheese_Indicator (not just mozzarella)

```{r, message = FALSE, echo = FALSE, warning = FALSE}
meat_columns <- c("meat_sliced_ham", "meat_pepperoni", "meat_bacon", "meat_calabrese_salami", 
                  "meat_barbecued_chicken", "meat_italian_sausage", "meat_chorizo_sausage", 
                  "meat_prosciutto", "meat_æ…›duja_salami", "meat_pancetta", "meat_chicken", 
                  "meat_beef_chuck_roast", "meat_capocollo", "meat_genoa_salami", 
                  "meat_prosciutto_di_san_daniele", "meat_coarse_sicilian_salami", 
                  "meat_luganega_sausage", "meat_soppressata_salami")


# Calculate correlation between each meat column and sales
correlations <- sapply(meat_columns, function(col) cor(train$total_sales, train[[col]]))

# Create a data frame for plotting
correlation_data <- data.frame(meat = meat_columns, correlation = correlations)

# Sort the data frame by correlation values
correlation_data <- correlation_data[order(correlation_data$correlation, decreasing = TRUE), ]

# Bar chart
ggplot(correlation_data, aes(x = meat, y = correlation)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "black") +
  labs(title = "Correlation between Meat Types and Sales",
       x = "Meat Types",
       y = "Correlation with Sales") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


# Results (6-7)


# Discussion of Limitations (8)

Concerns regarding the i.i.d assumption arise due to several factors. Primarily, there is a time series nature of grouping the total sales by month. Pizza sales of one month could influence by pizza sales of the next month due to factors like customer retention or word-of-mouth. **Talk about how we try to account for this??**. Secondly, there is the potential of geographic clustering as we do not have location data in this dataset. Geographical groupings could influence pizza sales by reflecting regional or local sales trends. Additionally, there is the possibility of repeat customers in the database. Repeat pulls may not represent a random sampling and could influence the results by skewing towards repeat customers' personal preferences. Finally, the dataset does not specify if promotions or discounts occurred during the sampling. Promotions can change the underlying sampling distribution since a heavier weight with will be applied towards whichever pizza is currently discounted.

Regarding structural limitations, the validity of our estimates on the impact of meat pizza sales may be biased by several omitted variables. An example of such a variable is religion. Many religions tend to restrict meat consumption, which will negatively correlate with the amount meat on pizzas. Additionally, religions tend to emphasize healthier diets and could have a negative correlation with total pizza sales. Therefore, we anticipate a positive omitted variable bias due to religion, which would result in a bias away from zero.

Income level is another variable to consider. Affluent consumers may be able to afford the premium or meat-heavy pizzas, which results in a positive correlation with meat consumption. However, wealthier demographics tend to eat healthier foods, and thus overall pizza sales may decline, resulting in a negative correlation. Therefore, we predict a negative omitted variable bias, resulting in a bias towards zero, underestimating the impact of meat on pizza sales.

One final example, which is challenging to pinpoint bias directionality for, is the impact of marketing. Effective marketing can be assumed to increase the sales of the marketed pizza, regardless of the meat content. We assume this will have a positive correlation with total pizza sales but could have a positive or negative correlation with meat consumption depending on whether meat or vegetarian pizzas were marketed. Therefore, this could lead to a positive or negative bias, depending on which marketing strategy that was employed.
